name: dataset-physics

on:
  push:
  pull_request:

jobs:
  physics:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Dataset physics checks
        run: python meta/physics_test.py

      - name: Parse JSON/YAML (best effort)
        shell: bash
        run: |
          set -euo pipefail
          python - <<'PY'
          import json
          import os
          import sys

          yaml_available = False
          try:
            import yaml  # type: ignore
            yaml_available = True
          except Exception:
            pass

          errors = []
          for root, _, files in os.walk("."):
            if root.startswith("./.git"):
              continue
            for filename in files:
              path = os.path.join(root, filename)
              if filename.endswith(".json"):
                try:
                  with open(path, "r", encoding="utf-8") as handle:
                    json.load(handle)
                except Exception as exc:
                  errors.append(f"JSON parse failed: {path}: {exc}")
              elif filename.endswith((".yml", ".yaml")) and yaml_available:
                try:
                  with open(path, "r", encoding="utf-8") as handle:
                    yaml.safe_load(handle)
                except Exception as exc:
                  errors.append(f"YAML parse failed: {path}: {exc}")

          if errors:
            print("\n".join(errors))
            sys.exit(1)
          PY
